{% extends "base.html" %}

{% block title %}File Comparison{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index/index.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
{% endblock %}

{% block content %}

<div id="content">
    <div class="menu-trigger"></div>
    <section class="cards-wrapper">
        <div class="cards-container">
            <!-- 동적으로 카드가 추가될 영역 -->
        </div>
    </section>

    <!-- 메타데이터 카드 슬라이드 -->
    <section class="metadata-cards-wrapper" style="display: none;">
        <!-- 초기에는 숨김 -->
        <div class="metadata-cards-container">
            <!-- 메타데이터 카드가 추가될 영역 -->
        </div>
    </section>
    <div class="commit-and-content-container">
        <div class="commit-cards-container">
            <!-- 커밋 카드가 추가될 영역 -->
        </div>
        <!-- 파일 내용 표시 영역 -->
        <div id="file-content-display">
            <!-- 파일 내용이 여기 표시됩니다. -->
        </div>
    </div>
</div>

<div class="sidebar">
    <h2>개인프로젝트</h2>
    <button id="commit-button" class="action-btn">Commit</button>
    <span id="file1-name" class="file-name"></span>
    <div class="structure-container" id="original-structure-container">
        <!-- Original file structure will be displayed here -->
    </div>
</div>

<div class="main-content">
    <h1>파일 비교</h1>
    <input type="text" id="commitMessage" placeholder="Enter commit message">
    <div id="result-message" class="result-message"></div>
    <div class="results">
        <div class="column content-column">
            <div class="title-section">
                <h3>원본 파일 내용</h3>
            </div>
            <div class="upload-section">
                <input type="file" webkitdirectory directory name="file1" id="file1" class="file-input" style="display: none;" required>
                <button type="button" class="open-file-btn" onclick="document.getElementById('file1').click();">디렉토리 선택</button>
            </div>
            <div class="file-content" id="original-file-content">
                <!-- Original file content will be displayed here -->
            </div>
        </div>
        <div class="column content-column">
            <div class="title-section">
                <h3>변경 파일 내용</h3>
            </div>
            <div class="upload-section">
                <input type="file" name="file2" id="file2" class="file-input" style="display: none;" required>
                <button type="button" class="open-file-btn" onclick="document.getElementById('file2').click();">Open File</button>
                <span id="file2-name" class="file-name"></span>
            </div>
            <div class="file-content" id="changed-file-content">
                <!-- Changed file content will be displayed here -->
            </div>
        </div>
    </div>
    <div class="compare-section">
        <button id="compare-btn" class="action-btn">코드 차이점</button>
        <div class="comparison-result" id="comparison-result">
            <!-- Differences will be displayed here -->
        </div>
        <button id="review-btn" class="action-btn">AI 코드 리뷰</button>
        <div id="review-result">
            <!-- Review feedback will be displayed here -->
        </div>
    </div>

    <!-- 댓글 섹션 -->
    <div id="comment-section">
        <h2>댓글</h2>
        <form id="comment-form">
            <textarea id="user-comment" placeholder="Your Comment" class="textarea-field" required></textarea>
            <input type="hidden" id="page" value="home">
            <button id="submit-btn" type="submit" class="submit-btn">작성</button>
        </form>
        <div id="comments-list">
            {% for comment in comments %}
            <div class="comment">
                <p><strong>{{ comment.username }}</strong>: {{ comment.user_comment }}</p>
                {% if comment.admin_response %}
                <p><em>Admin:</em> {{ comment.admin_response }}</p>
                {% elif current_user.is_authenticated and current_user.is_admin %}
                <form class="response-form" data-id="{{ comment.id }}">
                    <textarea placeholder="Admin Response" class="textarea-field"></textarea>
                    <button type="submit" class="submit-btn">쓰기</button>
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
<script src="{{ url_for('static', filename='js/comments.js') }}"></script>
<script src="{{ url_for('static', filename='js/files.js') }}"></script>
{% endblock %}
